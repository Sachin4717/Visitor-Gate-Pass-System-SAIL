<script src="/static/js/underscore-min.js"></script>
<script src="/static/js/moment.min.js"></script>
<script src="/static/js/daterangepicker.js"></script>
  <link href="/static/css/daterangepicker.css" rel="stylesheet">
<script src="/static/ngJS/ngComplaintUpdate.js?version=12072025" type="text/javascript"></script>
<style type="text/css">
    .bv-form .form-control {
        padding: 2px 4px !important;
        height:auto!important;
    }

    .input-group > .input-group-text:nth-of-type(1) {
       min-width: 40px !important;
        padding: 5px!important;
        font-size:12px!important;
        font-weight: bold!important;
        background-color: #22608e!important;
    }

    .input-group > .input-group-text:nth-of-type(2) {
       min-width: 40px !important;
        padding: 5px!important;
        font-size:12px!important;
        font-weight: bold!important;
        background-color: #effa91ff!important;
    }
    .nav-tabs .nav-link {
        background-color: #f1efef!important;
        margin:2px 2px;
    }

    .nav-tabs .nav-link.active {
        background-color: #22608e!important;
        color: #f1efef!important;
    }



</style>
{% load custom_tags %}
<div class="content-wrapper" ng-app="eDeskApp" ng-controller="eDeskCtrl">
    <p style="display:none;" id="modelData">{{jsontxt}}</p>
    <div class="container">
        <ul class="nav nav-tabs justify-content-start" role="tablist" >
            {% for ky, vl in clms.items %}
                <li class="nav-item">
                    <a {% if forloop.counter > stg %}disabled{% endif %} role="tab" data-bs-toggle="tab" style="font-size:12px!important;" class="nav-link {% if forloop.first %}active{% endif %}" href="#stg{{ forloop.counter }}">
                        <b>Stage#{{forloop.counter}}</b><br>
                        {{ ky }}
                    </a>
                </li>
            {% endfor %}
        </ul>
        <div class="tab-content row no-gutters">
            {% for ky, vl in clms.items %}
                <div class="tab-pane col-lg-12 {% if forloop.first %}active{% endif %}" title="" role="tabpanel" id="stg{{forloop.counter}}">
                    <form 
                        method="post" 
                        name="frmStage{{forloop.counter}}" 
                        id="frmStage{{forloop.counter}}"
                        class="mt-3 bv-form frmStage{{forloop.counter}}"
                        data-bv-feedbackicons-valid="bx bxs-check-circle"
                        data-bv-feedbackicons-invalid="bx bxs-x-circle"
                        data-bv-feedbackicons-validating="bx bxs-refresh"
                        novalidate>
                        {% csrf_token %}
                        <input type="hidden" name="STGNO" value="{{forloop.counter}}" />
                        <input type="hidden" name="ID" ng-model="comp.ID" value="{{comp.ID}}" />
                        <div class="alert alert-light">
                        <p class="title-text">Please provide information for Stage#{{forloop.counter}} {{ ky }}</p>
                        <div class="row">
                            {% for clm in vl%}
                            <div class="col-lg-6">
                                <div class="input-group">
                                    <p class="input-label">
                                        {% if clm.IC %}<b class="text-danger">*</b>{% endif %}  
                                        <i style="font-size:12px;">
                                            {{clm.LBL}}
                                        </i>
                                    </p>
                                    <div class="input-group-text"></div>
                                    {% if ddlist|has_key:clm.VL %}
                                        <select name="{{clm.VL}}" class="form-control"
                                            {% if clm.IC %}ng-minlength="1"{% endif %}
                                            {% if clm.IC %}required{% endif %} 
                                            ng-model="comp['{{clm.VL}}']" 
                                            ng-change="SelectionChanged('frmStage{{forloop.counter}}', '{{clm.VL}}')"
                                            enter-as-tab>
                                            <option value="">--select--</option>
                                            {% for item in ddlist|get_list:clm.VL %}
                                                <option value="{{ item }}">{{ item }}</option>
                                            {% endfor %}
                                        </select>
                                    {% elif clm.DL == -1 %}
                                        <textarea ng-model="comp['{{clm.VL}}']"  name="{{clm.VL}}" class="form-control" rows="3" {% if clm.IC %}ng-minlength="1"{% endif %} {% if clm.IC %}required{% endif %} enter-as-tab></textarea>
                                    {% elif clm.DT == 'date' %}
                                        <input ng-model="comp['{{clm.VL}}']"  type="text"  class="form-control {% if clm.DT == 'date' %}datepicker{% endif %}" name="{{clm.VL}}" {% if clm.IC %}ng-minlength="1"{% endif %} {% if clm.IC %}required readonly{% endif %} enter-as-tab/>
                                    {% else %}
                                        <input ng-model="comp['{{clm.VL}}']"  type="text"  class="form-control" name="{{clm.VL}}" {% if clm.IC %}ng-minlength="1"{% endif %} {% if clm.IC %}required{% endif %} enter-as-tab/>
                                    {% endif %}
                                    <div class="input-group-text"></div>
                                </div>
                            </div>
                            {% endfor %}

                            <div class="col-lg-12 text-end">
                                <button type="submit" ng-click="SubmitForm('frmStage{{forloop.counter}}')" ng-disabled="!(frmStage{{forloop.counter}}.$valid)" class="btn btn-sm btn-success">
                                    <b class="bx bx-save"> </b>Save Changes
                                </button>
                            </div>

                        </div>
                        
                    </div>
                    </form>
                </div>
            {% endfor %}
        </div>
    </div>
</div>